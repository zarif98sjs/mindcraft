<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="This is a write-up and a pseudo tutorial written while making this C Compiler. You can follow along and write a compiler of your own. Here I design a compiler for a subset of C language. If you are he">
<meta property="og:type" content="article">
<meta property="og:title" content="Yet Another C Compiler">
<meta property="og:url" content="https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/index.html">
<meta property="og:site_name" content="MindCraft">
<meta property="og:description" content="This is a write-up and a pseudo tutorial written while making this C Compiler. You can follow along and write a compiler of your own. Here I design a compiler for a subset of C language. If you are he">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gh-card.dev/repos/zarif98sjs/Yet-Another-C-Compiler.svg">
<meta property="og:image" content="https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/symboltable.png">
<meta property="article:published_time" content="2021-07-15T00:00:00.000Z">
<meta property="article:modified_time" content="2021-07-15T08:04:32.887Z">
<meta property="article:author" content="Md. Zarif Ul Alam">
<meta property="article:tag" content="Compiler">
<meta property="article:tag" content="Bison">
<meta property="article:tag" content="Flex">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gh-card.dev/repos/zarif98sjs/Yet-Another-C-Compiler.svg">
    
    
      
        
          <link rel="shortcut icon" href="/mindcraft/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/mindcraft/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/mindcraft/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Yet Another C Compiler</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/mindcraft/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/mindcraft/">Home</a></li>
         
          <li><a href="/mindcraft/archives/">Archive</a></li>
         
          <li><a href="https://zarif98sjs.github.io/">About Me</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post " href="/mindcraft/TF_Advanced_P3/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top " href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post " href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&text=Yet Another C Compiler"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&title=Yet Another C Compiler"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&is_video=false&description=Yet Another C Compiler"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Yet Another C Compiler&body=Check out this article: https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&title=Yet Another C Compiler"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&title=Yet Another C Compiler"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&title=Yet Another C Compiler"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&title=Yet Another C Compiler"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&name=Yet Another C Compiler&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&t=Yet Another C Compiler"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Part-1-Creating-a-Symbol-Table"><span class="toc-number">1.</span> <span class="toc-text">Part 1 : Creating a Symbol Table</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SymbolInfo"><span class="toc-number">1.1.</span> <span class="toc-text">SymbolInfo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ScopeTable"><span class="toc-number">1.2.</span> <span class="toc-text">ScopeTable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SymbolTable"><span class="toc-number">1.3.</span> <span class="toc-text">SymbolTable</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Part-2-Lexical-Analysis"><span class="toc-number">2.</span> <span class="toc-text">Part 2 : Lexical Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#flex-definition"><span class="toc-number">2.1.</span> <span class="toc-text">flex definition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flex-rule"><span class="toc-number">2.2.</span> <span class="toc-text">flex rule</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flex-states"><span class="toc-number">2.3.</span> <span class="toc-text">flex states</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flex-errors"><span class="toc-number">2.4.</span> <span class="toc-text">flex errors</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Part-3-Parser-Syntax-Analysis-amp-Semantic-Analysis"><span class="toc-number">3.</span> <span class="toc-text">Part 3 : Parser(Syntax Analysis) &amp; Semantic Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-Code"><span class="toc-number">3.1.</span> <span class="toc-text">User Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stack"><span class="toc-number">3.2.</span> <span class="toc-text">Stack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-YYSTYPE"><span class="toc-number">3.2.1.</span> <span class="toc-text">Using YYSTYPE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-union"><span class="toc-number">3.2.2.</span> <span class="toc-text">Using union</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token"><span class="toc-number">3.3.</span> <span class="toc-text">Token</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-YYSTYPE-1"><span class="toc-number">3.3.1.</span> <span class="toc-text">Using YYSTYPE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-union-1"><span class="toc-number">3.3.2.</span> <span class="toc-text">Using union</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Type"><span class="toc-number">3.4.</span> <span class="toc-text">Type</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-YYSTYPE-2"><span class="toc-number">3.4.1.</span> <span class="toc-text">Using YYSTYPE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-union-2"><span class="toc-number">3.4.2.</span> <span class="toc-text">Using union</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Grammar"><span class="toc-number">3.5.</span> <span class="toc-text">Grammar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Accessing-token-and-types"><span class="toc-number">3.6.</span> <span class="toc-text">Accessing token and types</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Precedence"><span class="toc-number">3.7.</span> <span class="toc-text">Precedence</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shift-Reduce-Conflict"><span class="toc-number">3.8.</span> <span class="toc-text">Shift&#x2F;Reduce Conflict</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Freeing-Memory-Part-1"><span class="toc-number">3.9.</span> <span class="toc-text">Freeing Memory : Part 1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Caution"><span class="toc-number">3.9.1.</span> <span class="toc-text">Caution</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Part-4-Error-Recovery"><span class="toc-number">4.</span> <span class="toc-text">Part 4 : Error Recovery</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Freeing-Memory-Part-2"><span class="toc-number">4.1.</span> <span class="toc-text">Freeing Memory : Part 2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Part-5-Intermediate-Code-Generator"><span class="toc-number">5.</span> <span class="toc-text">Part 5 : Intermediate Code Generator</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Final-Words"><span class="toc-number">6.</span> <span class="toc-text">Final Words</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Md-Zarif-Ul-Alam"><span class="toc-number">6.0.1.</span> <span class="toc-text">Md. Zarif Ul Alam</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Yet Another C Compiler
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Md. Zarif Ul Alam</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-07-15T00:00:00.000Z" itemprop="datePublished">2021-07-15</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/mindcraft/categories/Compiler/">Compiler</a> › <a class="category-link" href="/mindcraft/categories/Compiler/Deep-Dive/">Deep Dive</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/mindcraft/tags/Bison/" rel="tag">Bison</a>, <a class="tag-link-link" href="/mindcraft/tags/Compiler/" rel="tag">Compiler</a>, <a class="tag-link-link" href="/mindcraft/tags/Flex/" rel="tag">Flex</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>This is a write-up and a pseudo tutorial written while making this C Compiler. You can follow along and write a compiler of your own. Here I design a compiler for a subset of C language.</p>
<p>If you are here for the code and submit a copy-pasta (you know who you are and why), just want to let you know that the hall of shame will not have mercy upon you :)</p>
<p>You can find related code down here -</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zarif98sjs/Yet-Another-C-Compiler"><img src="https://gh-card.dev/repos/zarif98sjs/Yet-Another-C-Compiler.svg" alt="zarif98sjs/Yet-Another-C-Compiler - GitHub"></a></p>
<h1 id="Part-1-Creating-a-Symbol-Table"><a href="#Part-1-Creating-a-Symbol-Table" class="headerlink" title="Part 1 : Creating a Symbol Table"></a>Part 1 : <strong><code>Creating a Symbol Table</code></strong></h1><p>The first part needed to make a <code>Compiler</code> is a <code>Symbol Table</code>. A Symbol Table is a data structure maintained by compilers in order to store information about the occurrence of various entities such as identifiers, objects, function names etc. Information of different entities may include type, value, scope etc. </p>
<p>At the starting phase of constructing a compiler, we will construct<br>a Symbol Table which maintains a list of <code>Hash Tables(Scope Tables)</code> where each hash table contains information of symbols encountered in a scope of the source program . Each Scope Table will have <code>Symbol Info</code> (which will store the information) in it’s buckets.</p>
<p>Here is an overview </p>
<img src="symboltable.png" />
<!-- ![](images/symboltable.png) -->

<p>Now straight to code . I am showing the declarations here . The full implementation can be found in the code directory.</p>
<h2 id="SymbolInfo"><a href="#SymbolInfo" class="headerlink" title="SymbolInfo"></a><code>SymbolInfo</code></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SYMBOLTABLE_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SYMBOLTABLE_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ScopeTable.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="function">string <span class="title">to_str</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    stringstream ss;</span><br><span class="line">    ss&lt;&lt;x;</span><br><span class="line">    <span class="keyword">return</span> ss.<span class="built_in">str</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SymbolTable</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ScopeTable* cur;</span><br><span class="line">    <span class="keyword">int</span> bucket_size;</span><br><span class="line">    function&lt;<span class="built_in"><span class="keyword">int</span></span>(string)&gt; func;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="built_in">SymbolTable</span>(<span class="keyword">int</span> bucket_size,T func) <span class="comment">/// constructor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;bucket_size = bucket_size;</span><br><span class="line">        <span class="keyword">this</span>-&gt;func = func;</span><br><span class="line"></span><br><span class="line">        cur = <span class="keyword">new</span> <span class="built_in">ScopeTable</span>(bucket_size,func);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">SymbolTable</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">enter_scope</span><span class="params">()</span></span>; <span class="comment">/// enter scope  = push : create and push a new ScopeTable</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exit_scope</span><span class="params">()</span></span>; <span class="comment">/// exit scope  = pop : remove the current ScopeTable</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">insert_symbol</span><span class="params">(SymbolInfo si)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">remove_symbol</span><span class="params">(string key)</span></span>;</span><br><span class="line">    <span class="function">SymbolInfo* <span class="title">lookup</span><span class="params">(string key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print_current_scope</span><span class="params">(ofstream &amp;out)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print_all_scope</span><span class="params">(ofstream &amp;out)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">string <span class="title">getCurScopeTableId</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// SYMBOLTABLE_H</span></span></span><br></pre></td></tr></table></figure>

<h2 id="ScopeTable"><a href="#ScopeTable" class="headerlink" title="ScopeTable"></a><code>ScopeTable</code></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SCOPETABLE_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SCOPETABLE_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;SymbolInfo.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ScopeTable</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    string id;</span><br><span class="line">    <span class="keyword">int</span> counter;</span><br><span class="line"></span><br><span class="line">    ScopeTable* parentScope;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> M; <span class="comment">/* initial hast table size */</span></span><br><span class="line"></span><br><span class="line">    vector&lt;SymbolInfo*&gt;ht;</span><br><span class="line"></span><br><span class="line">    function&lt;<span class="built_in"><span class="keyword">int</span></span>(string)&gt; hashValue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="built_in">ScopeTable</span>(<span class="keyword">int</span> table_size,T func)</span><br><span class="line">    &#123;</span><br><span class="line">        id = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        counter = <span class="number">1</span>;</span><br><span class="line">        parentScope = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        M = table_size;</span><br><span class="line">        hashValue = func;</span><br><span class="line"></span><br><span class="line">        ht = vector&lt;SymbolInfo*&gt;(M);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">ScopeTable</span>(); <span class="comment">/// destructor</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// id</span></span><br><span class="line">    <span class="function">string <span class="title">get_id</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_id</span><span class="params">(string id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// counter</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_counter</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_counter</span><span class="params">(<span class="keyword">int</span> counter)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">increase_counter</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// hash</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hash</span><span class="params">(string key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// mehtods</span></span><br><span class="line">    <span class="function">SymbolInfo* <span class="title">search</span><span class="params">(string key)</span></span>;</span><br><span class="line">    <span class="function">SymbolInfo* <span class="title">insert</span><span class="params">(SymbolInfo si)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">erase</span><span class="params">(string key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// prints</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printChainLengths</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// SCOPETABLE_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="SymbolTable"><a href="#SymbolTable" class="headerlink" title="SymbolTable"></a><code>SymbolTable</code></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SYMBOLTABLE_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SYMBOLTABLE_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Which of the favors of your Lord will you deny ? */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ScopeTable.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="function">string <span class="title">to_str</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    stringstream ss;</span><br><span class="line">    ss&lt;&lt;x;</span><br><span class="line">    <span class="keyword">return</span> ss.<span class="built_in">str</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SymbolTable</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ScopeTable* cur;</span><br><span class="line">    <span class="keyword">int</span> bucket_size;</span><br><span class="line">    function&lt;<span class="built_in"><span class="keyword">int</span></span>(string)&gt; func;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="built_in">SymbolTable</span>(<span class="keyword">int</span> bucket_size,T func) <span class="comment">/// constructor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;bucket_size = bucket_size;</span><br><span class="line">        <span class="keyword">this</span>-&gt;func = func;</span><br><span class="line"></span><br><span class="line">        cur = <span class="keyword">new</span> <span class="built_in">ScopeTable</span>(bucket_size,func);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">SymbolTable</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">enter_scope</span><span class="params">()</span></span>; <span class="comment">/// enter scope  = push : create and push a new ScopeTable</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exit_scope</span><span class="params">()</span></span>; <span class="comment">/// exit scope  = pop : remove the current ScopeTable</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">insert_symbol</span><span class="params">(SymbolInfo si)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">remove_symbol</span><span class="params">(string key)</span></span>;</span><br><span class="line">    <span class="function">SymbolInfo* <span class="title">lookup</span><span class="params">(string key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print_current_scope</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print_all_scope</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">string <span class="title">getCurScopeTableId</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// SYMBOLTABLE_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Part-2-Lexical-Analysis"><a href="#Part-2-Lexical-Analysis" class="headerlink" title="Part 2 : Lexical Analysis"></a>Part 2 : <strong><code>Lexical Analysis</code></strong></h1><p>Lexical analysis is the process of scanning the source program as a sequence of characters and converting them into sequences of tokens. A program that performs this task is called a lexical analyzer or a lexer or a scanner.</p>
<p>Here we will use the tool <code>flex</code> to do the lexical analysis. Regex is written to do the lexical analysis with flex.</p>
<p>Here is a basic structure of a <code>lex</code> file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line">    user code section 1</span><br><span class="line">%&#125;</span><br><span class="line">    definition section</span><br><span class="line">%%</span><br><span class="line">    rules section</span><br><span class="line">%%</span><br><span class="line">    user code section 2</span><br></pre></td></tr></table></figure>

<p>Regular Expression is a very powerful tool which we will use in this section to identify the tokens. To check what can be done using regular expression in flex, check <a target="_blank" rel="noopener" href="https://www.cs.virginia.edu/~cr4bd/flex-manual/Patterns.html">this</a> for the rules available in flex. You can also use <a target="_blank" rel="noopener" href="https://regexr.com/">regexr.com</a> to test if your regex performs exactly how you want it to be.</p>
<h2 id="flex-definition"><a href="#flex-definition" class="headerlink" title="flex definition"></a><strong><code>flex</code> definition</strong></h2><p>This is the required syntax for definition :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">definition_name definition</span><br></pre></td></tr></table></figure>

<p>So, we can define things like this :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WHITESPACE [ \t\f\r\v]+ </span><br><span class="line">LETTER [a-zA-Z_]</span><br><span class="line">DIGIT [<span class="number">0</span><span class="number">-9</span>]</span><br><span class="line">NEWLINE [\r]?\n</span><br><span class="line">ALNUM [A-Za-z_0<span class="number">-9</span>]</span><br><span class="line">ALL_EXCEPT_BACKSLASH [^\\]</span><br></pre></td></tr></table></figure>

<h2 id="flex-rule"><a href="#flex-rule" class="headerlink" title="flex rule"></a><strong><code>flex</code> rule</strong></h2><p>The part that is currently matched can be found in the string <code>yytext</code>.</p>
<p>We can write rules using the definitions already defined</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;LETTER&#125;&#123;ALNUM&#125;*	&#123;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;ID , &quot;</span>&lt;&lt;yytext&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>or we can completely use new ones</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&lt;&quot;</span>|<span class="string">&quot;&lt;=&quot;</span>|<span class="string">&quot;&gt;&quot;</span>|<span class="string">&quot;&gt;=&quot;</span>|<span class="string">&quot;==&quot;</span>|<span class="string">&quot;!=&quot;</span>	&#123;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;RELOP , &quot;</span>&lt;&lt;yytext&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="flex-states"><a href="#flex-states" class="headerlink" title="flex states"></a><strong><code>flex</code> states</strong></h2><p>Sometimes it is easy to handle rules for different things separately. Like our life will be much easier if we handle things like <code>char</code> <code>string</code> or <code>comment</code> separately.</p>
<p>To do this we can enter a state by using <code>BEGIN STATE_NAME</code> and exit using <code>BEGIN INITIAL</code>.</p>
<h2 id="flex-errors"><a href="#flex-errors" class="headerlink" title="flex errors"></a><strong><code>flex</code> errors</strong></h2><p>We can also write regex to identify common errors like “Too many decimal points” , “Ill formed number” or “Invalid ID” etc.</p>
<p>For example a regex for “Too many decimal points” can be something like this</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;DIGIT&#125;*(\.&#123;DIGIT&#125;+)\.[<span class="number">0</span><span class="number">-9</span>\.Ee+-]*(\.)*</span><br></pre></td></tr></table></figure>



<h1 id="Part-3-Parser-Syntax-Analysis-amp-Semantic-Analysis"><a href="#Part-3-Parser-Syntax-Analysis-amp-Semantic-Analysis" class="headerlink" title="Part 3 : Parser(Syntax Analysis) &amp; Semantic Analysis"></a>Part 3 : <strong><code>Parser(Syntax Analysis) &amp; Semantic Analysis</code></strong></h1><p>The parser obtains a string of tokens from the lexical analyzer and verifies that the string of token names can be generated by the <strong>grammar</strong> for the source language. The parser should also report any syntax errors in an intelligible fashion and recover from commonly occurring errors to continue processing the remainder of the program. </p>
<p>To make parser for grammar , we will use the tool <strong><code>bison</code></strong>.  This greatly reduces our work .</p>
<p>Here is a basic structure of a <strong><code>bison</code></strong> file </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line">    user code section <span class="number">1</span></span><br><span class="line">%&#125;</span><br><span class="line">    bison declarations</span><br><span class="line">%%</span><br><span class="line">    bison grammar rules</span><br><span class="line">%%</span><br><span class="line">    user code section <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h2 id="User-Code"><a href="#User-Code" class="headerlink" title="User Code"></a><strong>User Code</strong></h2><p>Codes written in this section is directly copied in the resulting <code>.c</code> file (<code>y.tab.c</code>). Here we include our previously written <code>SymbolInfo</code> <code>ScopeTable</code> and <code>SymbolTable</code> header files. We can also include custom libraries, constants and so on. Most includes and function prototype declarations happen at the top (<em>user code section 1</em>) while their actual definition happens at the bottom (<em>user code section 2</em>).</p>
<h2 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a><strong>Stack</strong></h2><h3 id="Using-YYSTYPE"><a href="#Using-YYSTYPE" class="headerlink" title="Using YYSTYPE"></a><strong>Using <code>YYSTYPE</code></strong></h3><p>We can hardcode a specific type for the terminals and non-terminals by defining <strong><code>YYSTYPE</code></strong>. </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> YYSTYPE SymbolInfo*</span></span><br></pre></td></tr></table></figure>

<p>and in the lex file, we can write something like this for the tokens</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;integer&#125;	&#123;</span><br><span class="line">				SymbolInfo *s= <span class="keyword">new</span>  <span class="built_in">SymbolInfo</span>(yytext,<span class="string">&quot;CONST_INT&quot;</span>);</span><br><span class="line">				yylval = (YYSTYPE)s;</span><br><span class="line">				<span class="keyword">return</span> CONST_INT;</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-union"><a href="#Using-union" class="headerlink" title="Using union"></a><strong>Using <code>union</code></strong></h3><p>Using <strong><code>union</code></strong>  we can specify types for the terminals(<code>token</code>) and non-terminals(<code>type</code>) . We have to tell bison the type of that particular <code>token</code> / <code>type</code> by declaring it inside a special union like this :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%<span class="class"><span class="keyword">union</span>&#123;</span></span><br><span class="line">    SymbolInfo* symbol_info;</span><br><span class="line">    Helper* helper;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This <code>union</code> tells <code>bison</code> that when we use a <code>token</code> / <code>type</code> that is accompanied by <strong><code>symbol_info</code></strong> then we can use its value like <strong><code>SymbolInfo*</code></strong>. On the other hand if its accompanied by <strong><code>helper</code></strong> then that value will be treated as a<br><strong><code>Helper*</code></strong> instead.</p>
<p>It has to be noted that being a <code>union</code> and not a <code>struct</code> it also means the values use <em>shared</em> memory and not separate segments as opposed to <code>struct</code> fields. We can have as many different tags as we want inside the union and both <code>tokens</code> and <code>types</code> can have the <em>same</em> tag.</p>
<h2 id="Token"><a href="#Token" class="headerlink" title="Token"></a><strong>Token</strong></h2><p>Terminals are called <code>token</code> in Bison. The tokens must be first declared in the parser. Because the tokens are generated in the <code>y.tab.h</code> file, then used in the flex file <code>scanner.l</code>. Token declarations must be inside bison’s <code>declaration section</code>. We can use <strong><code>YYSTYPE</code></strong> or <strong><code>union</code></strong> to define token types.</p>
<h3 id="Using-YYSTYPE-1"><a href="#Using-YYSTYPE-1" class="headerlink" title="Using YYSTYPE"></a><strong>Using <code>YYSTYPE</code></strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%token ID ADDOP MULOP RELOP LOGICOP</span><br></pre></td></tr></table></figure>

<h3 id="Using-union-1"><a href="#Using-union-1" class="headerlink" title="Using union"></a><strong>Using <code>union</code></strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%token &lt; symbol_info &gt; ID ADDOP MULOP RELOP LOGICOP</span><br></pre></td></tr></table></figure>

<h2 id="Type"><a href="#Type" class="headerlink" title="Type"></a><strong>Type</strong></h2><p>Non-terminals are called <code>type</code> in Bison. These non-terminals/state can have a return value, much like <code>tokens</code>. We can use <strong><code>YYSTYPE</code></strong> or <strong><code>union</code></strong> to define types in the same way.</p>
<h3 id="Using-YYSTYPE-2"><a href="#Using-YYSTYPE-2" class="headerlink" title="Using YYSTYPE"></a><strong>Using <code>YYSTYPE</code></strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%type start program unit variable var_declaration type_specifier</span><br></pre></td></tr></table></figure>

<h3 id="Using-union-2"><a href="#Using-union-2" class="headerlink" title="Using union"></a><strong>Using <code>union</code></strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%type &lt; helper &gt; start program unit variable var_declaration type_specifier</span><br></pre></td></tr></table></figure>

<h2 id="Grammar"><a href="#Grammar" class="headerlink" title="Grammar"></a><strong>Grammar</strong></h2><p>In <code>bison</code> we create a <em>grammar</em> which syntactically evaluates if the <code>tokens</code> that <code>flex</code> generated are emitted in a syntactically correct order. In order to do that we will have to take a good look at our language specification and break it down to building blocks that we then have to express using <code>bison</code> rules.</p>
<p>Grammar rules in general have the following syntax:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rule_name:</span><br><span class="line">    caseA</span><br><span class="line">    | caseB</span><br><span class="line">        .</span><br><span class="line">        .</span><br><span class="line">    | caseN</span><br><span class="line">    ;</span><br></pre></td></tr></table></figure>

<p>A rule starts by typing its <em>unique</em> name then a colon (<code>:</code>) followed by a number of cases which are separated<br>with a dash <code>|</code>; the last rule <em>must</em> be followed by a semicolon (<code>;</code>). Also rules don’t have to be separated<br>by lines so this would be perfectly legal as well:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rule_name: caseA | caseB | ... | caseN;</span><br></pre></td></tr></table></figure>

<p>It is also possible to write action codes:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func_declaration : type_specifier ID LPAREN parameter_list RPAREN &#123; <span class="comment">/** can write code here : known as action code **/</span> &#125; SEMICOLON</span><br></pre></td></tr></table></figure>

<p>The grammar we will use here is the following :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">start : program</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//write your code in this block in all the similar blocks below</span></span><br><span class="line">	&#125;</span><br><span class="line">	;</span><br><span class="line"></span><br><span class="line">program : program unit </span><br><span class="line">	| unit</span><br><span class="line">	;</span><br><span class="line">	</span><br><span class="line">unit : var_declaration</span><br><span class="line">     | func_declaration</span><br><span class="line">     | func_definition</span><br><span class="line">     ;</span><br><span class="line">     </span><br><span class="line">func_declaration : type_specifier ID LPAREN parameter_list RPAREN SEMICOLON</span><br><span class="line">		| type_specifier ID LPAREN RPAREN SEMICOLON</span><br><span class="line">		;</span><br><span class="line">		 </span><br><span class="line">func_definition : type_specifier ID LPAREN parameter_list RPAREN compound_statement</span><br><span class="line">		| type_specifier ID LPAREN RPAREN compound_statement</span><br><span class="line"> 		;				</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">parameter_list  : parameter_list COMMA type_specifier ID</span><br><span class="line">		| parameter_list COMMA type_specifier</span><br><span class="line"> 		| type_specifier ID</span><br><span class="line">		| type_specifier</span><br><span class="line"> 		;</span><br><span class="line"></span><br><span class="line"> 		</span><br><span class="line">compound_statement : LCURL statements RCURL</span><br><span class="line"> 		    | LCURL RCURL</span><br><span class="line"> 		    ;</span><br><span class="line"> 		    </span><br><span class="line">var_declaration : type_specifier declaration_list SEMICOLON</span><br><span class="line"> 		 ;</span><br><span class="line"> 		 </span><br><span class="line">type_specifier	: INT</span><br><span class="line"> 		| FLOAT</span><br><span class="line"> 		| VOID</span><br><span class="line"> 		;</span><br><span class="line"> 		</span><br><span class="line">declaration_list : declaration_list COMMA ID</span><br><span class="line"> 		  | declaration_list COMMA ID LTHIRD CONST_INT RTHIRD</span><br><span class="line"> 		  | ID</span><br><span class="line"> 		  | ID LTHIRD CONST_INT RTHIRD</span><br><span class="line"> 		  ;</span><br><span class="line"> 		  </span><br><span class="line">statements : statement</span><br><span class="line">	   | statements statement</span><br><span class="line">	   ;</span><br><span class="line">	   </span><br><span class="line">statement : var_declaration</span><br><span class="line">	  | expression_statement</span><br><span class="line">	  | compound_statement</span><br><span class="line">	  | FOR LPAREN expression_statement expression_statement expression RPAREN statement</span><br><span class="line">	  | IF LPAREN expression RPAREN statement</span><br><span class="line">	  | IF LPAREN expression RPAREN statement ELSE statement</span><br><span class="line">	  | WHILE LPAREN expression RPAREN statement</span><br><span class="line">	  | PRINTLN LPAREN ID RPAREN SEMICOLON</span><br><span class="line">	  | RETURN expression SEMICOLON</span><br><span class="line">	  ;</span><br><span class="line">	  </span><br><span class="line">expression_statement 	: SEMICOLON			</span><br><span class="line">			| expression SEMICOLON </span><br><span class="line">			;</span><br><span class="line">	  </span><br><span class="line">variable : ID 		</span><br><span class="line">	 | ID LTHIRD expression RTHIRD </span><br><span class="line">	 ;</span><br><span class="line">	 </span><br><span class="line"> expression : logic_expression	</span><br><span class="line">	   | variable ASSIGNOP logic_expression 	</span><br><span class="line">	   ;</span><br><span class="line">			</span><br><span class="line">logic_expression : rel_expression 	</span><br><span class="line">		 | rel_expression LOGICOP rel_expression 	</span><br><span class="line">		 ;</span><br><span class="line">			</span><br><span class="line">rel_expression	: simple_expression </span><br><span class="line">		| simple_expression RELOP simple_expression	</span><br><span class="line">		;</span><br><span class="line">				</span><br><span class="line">simple_expression : term </span><br><span class="line">		  | simple_expression ADDOP term </span><br><span class="line">		  ;</span><br><span class="line">					</span><br><span class="line">term :	unary_expression</span><br><span class="line">     |  term MULOP unary_expression</span><br><span class="line">     ;</span><br><span class="line"></span><br><span class="line">unary_expression : ADDOP unary_expression  </span><br><span class="line">		 | NOT unary_expression </span><br><span class="line">		 | factor </span><br><span class="line">		 ;</span><br><span class="line">	</span><br><span class="line">factor	: variable </span><br><span class="line">	| ID LPAREN argument_list RPAREN</span><br><span class="line">	| LPAREN expression RPAREN</span><br><span class="line">	| CONST_INT </span><br><span class="line">	| CONST_FLOAT</span><br><span class="line">	| variable INCOP </span><br><span class="line">	| variable DECOP</span><br><span class="line">	;</span><br><span class="line">	</span><br><span class="line">argument_list : arguments</span><br><span class="line">			  |</span><br><span class="line">			  ;</span><br><span class="line">	</span><br><span class="line">arguments : arguments COMMA logic_expression</span><br><span class="line">	      | logic_expression</span><br><span class="line">	      ;</span><br></pre></td></tr></table></figure>

<h2 id="Accessing-token-and-types"><a href="#Accessing-token-and-types" class="headerlink" title="Accessing token and types"></a><strong>Accessing <code>token</code> and <code>types</code></strong></h2><p>Flex returns <code>tokens</code> to parser. Parser tries to match grammar rules by shifting one by one and reduced when a rule is matched. <code>Token</code> and <code>types</code> can be accessed using <code>$1</code>, <code>$2</code>, … <code>$n</code> where n is the nth item of the rule. Each rule can return a value which is <code>$$</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arguments : arguments COMMA logic_expression</span><br><span class="line">    ^           ^       ^           ^</span><br><span class="line">    $$          $<span class="number">1</span>      $<span class="number">2</span>          $<span class="number">3</span></span><br></pre></td></tr></table></figure>

<h2 id="Precedence"><a href="#Precedence" class="headerlink" title="Precedence"></a><strong>Precedence</strong></h2><p>There are 4 types of precedence types in <code>bison</code> , 3 of which declare both precedence as well as associativity while the last (as its name suggests) declares only precedence. The complete list is the following:</p>
<ul>
<li><strong><code>%left</code></strong>: Indicates that this operator has <em>left</em> associativity (e.g. (a + b) + c is preferred)<ul>
<li>syntax is: <code>%left symbols</code></li>
</ul>
</li>
<li><strong><code>%right</code></strong>: Indicates that this operator has <em>right</em> associativity (e.g. a + (b + c) is preferred)<ul>
<li>syntax is: <code>%right symbols</code></li>
</ul>
</li>
<li><strong><code>%nonassoc</code></strong>: Indicates that this operator <strong>cannot be seen in sequence</strong> and is considered a <em>syntax error</em><br>if that’s encountered (e.g. a + b + c would throw an error).<ul>
<li>syntax is: <code>%nonassoc symbols</code></li>
</ul>
</li>
<li><strong><code>%precedence</code></strong>: Indicates just precedence <strong>not</strong> associativity.</li>
</ul>
<h2 id="Shift-Reduce-Conflict"><a href="#Shift-Reduce-Conflict" class="headerlink" title="Shift/Reduce Conflict"></a><strong><code>Shift/Reduce</code> Conflict</strong></h2><p>This type of conflict happens when <code>bison</code> does not know which operation to perform, <code>shift</code> or <code>reduce</code>. The given grammar has one example of this type of conflict :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">statement : IF LPAREN expression RPAREN statement</span><br><span class="line">	      | IF LPAREN expression RPAREN statement ELSE statement</span><br></pre></td></tr></table></figure>

<p>The example of this would be :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(x&lt;<span class="number">2</span>) <span class="keyword">if</span>(x&gt;<span class="number">0</span>) y = <span class="number">2</span>; <span class="keyword">else</span> z = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>Because of the ambiguity, the parser doesn’t know if he needs associate the <code>else</code> statement with the most recent <code>if</code> or not. That is it does not know if it already needs to reduce or continue to process the token <code>ELSE</code></p>
<p>We can solve this using 2 ways:</p>
<ul>
<li>rewrite the grammar </li>
<li>assign precedence to token </li>
</ul>
<p>The first part can be a tough job. Bison gives the opportunity to do the 2nd one.</p>
<p>We can solve this shift/reduce conflict by adding the following in the declaration section:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%nonassoc LOWER_THAN_ELSE</span><br><span class="line">%nonassoc ELSE</span><br></pre></td></tr></table></figure>

<p>and change the grammar rule to this:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">statement : IF LPAREN expression RPAREN statement %prec LOWER_THAN_ELSE</span><br><span class="line">	      | IF LPAREN expression RPAREN statement ELSE statement</span><br></pre></td></tr></table></figure>

<p>Here, we are using a dummy token <code>LOWER_THAN_ELSE</code> and putting it before <code>ELSE</code>, thus making <code>ELSE</code> the higher priority one.</p>
<h2 id="Freeing-Memory-Part-1"><a href="#Freeing-Memory-Part-1" class="headerlink" title="Freeing Memory : Part 1"></a><strong>Freeing Memory : Part 1</strong></h2><p>In <code>C</code> or <code>C++</code>, if you dynamically allocate memory, it is your job to free it yourself. <code>Bison</code> has no reasonable obligation to clean-up your mess :)  </p>
<p>Unfortunately most people somehow think that the <code>bison</code> (or <code>flex</code>) will take care of memory they allocate in the parser, but unfortunately that’s not the case.</p>
<p>Let’s see an example to demonstrate this. Here is an example rule from the grammar :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">unary_expression: ADDOP unary_expression  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print_grammar_rule</span>(<span class="string">&quot;unary_expression&quot;</span>,<span class="string">&quot;ADDOP unary_expression&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    $$ = <span class="keyword">new</span> <span class="built_in">Helper</span>();</span><br><span class="line">    <span class="comment">// update text</span></span><br><span class="line">    $$-&gt;text = $<span class="number">1</span>-&gt;key;</span><br><span class="line">    $$-&gt;text += $<span class="number">2</span>-&gt;text;</span><br><span class="line">    <span class="comment">// implicit typecast</span></span><br><span class="line">    $$-&gt;HelperType = $<span class="number">2</span>-&gt;HelperType;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print_log_text</span>($$-&gt;text);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But this implementation is not correct. <code>$1</code> represents a <code>SymbolInfo</code> pointer which was dynamically allocated in the lex file :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;+&quot;</span>|<span class="string">&quot;-&quot;</span> &#123; </span><br><span class="line">            SymbolInfo *s= <span class="keyword">new</span>  <span class="built_in">SymbolInfo</span>(yytext, <span class="string">&quot;ADDOP&quot;</span>); </span><br><span class="line">            yylval.symbol_info = s; </span><br><span class="line">            <span class="keyword">return</span> ADDOP;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>and for <code>$2</code> , it was also dynamically allocated in the parser in this rule :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">unary_expression: factor  &#123; </span><br><span class="line"></span><br><span class="line">    <span class="built_in">print_grammar_rule</span>(<span class="string">&quot;unary_expression&quot;</span>,<span class="string">&quot;factor&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    $$ = <span class="keyword">new</span> <span class="built_in">Helper</span>();</span><br><span class="line">    <span class="comment">// update text</span></span><br><span class="line">    $$-&gt;text = $<span class="number">1</span>-&gt;text;</span><br><span class="line">    <span class="comment">// implicit typecast</span></span><br><span class="line">    $$-&gt;HelperType = $<span class="number">1</span>-&gt;HelperType;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print_log_text</span>($$-&gt;text);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As mentioned before, if something is dynamically allocated, it’s your job to clean that up. So, we need to free <code>$1</code> and <code>$2</code> when we are done with them.</p>
<p>So, the correct way to write this would be :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">unary_expression: ADDOP unary_expression  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print_grammar_rule</span>(<span class="string">&quot;unary_expression&quot;</span>,<span class="string">&quot;ADDOP unary_expression&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    $$ = <span class="keyword">new</span> <span class="built_in">Helper</span>();</span><br><span class="line">    <span class="comment">// update text</span></span><br><span class="line">    $$-&gt;text = $<span class="number">1</span>-&gt;key;</span><br><span class="line">    $$-&gt;text += $<span class="number">2</span>-&gt;text;</span><br><span class="line">    <span class="comment">// implicit typecast</span></span><br><span class="line">    $$-&gt;HelperType = $<span class="number">2</span>-&gt;HelperType;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print_log_text</span>($$-&gt;text);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>($<span class="number">1</span>) ; <span class="built_in">free</span>($<span class="number">2</span>); <span class="comment">// freeing dynamically allocated memory</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Caution"><a href="#Caution" class="headerlink" title="Caution"></a><strong>Caution</strong></h3><p>But, you need to be careful when you are freeing memory. Imagine inside a rule you have done something like this :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$$ = $<span class="number">1</span>;</span><br><span class="line"><span class="built_in">free</span>($<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>Here both are pointers. So, what you are essentially doing is making <code>$$</code> point to <code>$1</code> and freeing <code>$1</code> (so, freeing <code>$$</code>). Next time you are trying to access <code>$$</code>, you will get <em><strong>core dumped</strong></em>.</p>
<p>Its also handy to write a cleanup function like the following so that we don’t accidentally free the ones that have already been freed.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eraseMemory_S</span><span class="params">(SymbolInfo* s)</span> <span class="comment">// erase memory of SymbolInfo pointer</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s!=<span class="literal">NULL</span>) <span class="built_in">free</span>(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eraseMemory_H</span><span class="params">(Helper* h)</span> <span class="comment">// erase memory of Helper pointer</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(h!=<span class="literal">NULL</span>) <span class="built_in">free</span>(h);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Part-4-Error-Recovery"><a href="#Part-4-Error-Recovery" class="headerlink" title="Part 4 : Error Recovery"></a>Part 4 : <strong><code>Error Recovery</code></strong></h1><p>During the shift reduce parser phase things <em><strong>can</strong>_ and _<strong>will</strong>_ go wrong. This can happen when the parser is unable to match with any of the rules. Under default conditions our parser will terminate after seeing the first error, these are called <strong><code>fail-fast parsers</code></strong>, but nobody actually wants them … (except maybe lazy students). This means that if our input has more than one mistake we would only detect the first and exit! This process would get quite tedious as _<strong>repeated compilations would be required</strong></em> in order to detect and fix all errors instead of reporting all errors in our source at the first parse.</p>
<p>Thankfully bison has error recovery capabilities! They are also quite simple to define and explain but require a lot of skill, practice and a hellish insight in order to be used correctly. Otherwise you will add one rule to recover error and get 30-40 shift reduce errors :p So you have to have proper insight about your grammar and handle errors that way. </p>
<p>One more thing, there is no limit to handling cases. Your user can do mistakes you can never think of. So, it boils down to how many cases you can think of and correct them by adding grammar rules.</p>
<p>For example, your user has written code like this :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x-y,z;</span><br></pre></td></tr></table></figure>

<p>probably the user wanted to give a <code>COMMA</code> but added a <code>MINUS</code> instead. If you try to run this with your parser, your parser will immediately stop after encountering this error. Because your parser can’t associate to any rule of this type. What you can do is handle the error using the bison <code>error</code> token. It is already defined in bison, you don’t have to define it. </p>
<p>We can add a rule to recover from this error :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">declaration_list: declaration_list COMMA ID &#123;</span><br><span class="line">                    <span class="comment">// regular rule</span></span><br><span class="line">                &#125;   </span><br><span class="line">                | declaration_list error COMMA ID &#123;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                        To handle errors like :</span></span><br><span class="line"><span class="comment">                            int x-y,z;</span></span><br><span class="line"><span class="comment">                    **/</span> </span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>

<p>The previous <code>lookahead</code> token is reanalyzed immediately after an error. If this is unacceptable, then the macro <code>yyclearin</code> may be used to clear this token. Write the statement <code>yyclearin;</code> in the error rule’s action.</p>
<p>Additionally, after encountering an error it’s likely that this fact will then create much more consecutive errors; to avoid this console spam <code>bison</code> <em>suppresses</em> error messages until 3 consecutive <code>tokens</code> have been parsed and shifted successfully. If you don’t like (or want) this behavior by default you can put <code>yyerrok;</code> inside the <code>error</code> rule.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">declaration_list: declaration_list COMMA ID &#123;</span><br><span class="line">                    <span class="comment">// regular rule</span></span><br><span class="line">                &#125;   </span><br><span class="line">                | declaration_list error COMMA ID &#123;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                        To handle errors like :</span></span><br><span class="line"><span class="comment">                            int x-y,z;</span></span><br><span class="line"><span class="comment">                    **/</span> </span><br><span class="line"></span><br><span class="line">                    yyclearin;</span><br><span class="line">                    yyerrok;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>

<p>Just like this, you have to thoroughly think of the corner cases that can happen and handle accordingly.</p>
<h2 id="Freeing-Memory-Part-2"><a href="#Freeing-Memory-Part-2" class="headerlink" title="Freeing Memory : Part 2"></a><strong>Freeing Memory : Part 2</strong></h2><p>So far we have only handled only one part of the memory de-allocation process. As we have seen in the error recovery process, things can go wrong during parsing and we have to account for that. Thankfully <code>bison</code> has the ability to clean its own stuff when something does go wrong, but what about <em>our</em> dynamically allocated symbols. Thankfully, <code>bison</code> has a facility that can help us free-up own resources by calling a <code>destructor</code> on each of the discarded symbols, but what does <code>bison</code> consider as a <em>discarded symbol</em>? The following list is mostly an extract from <code>bison</code>‘s manual which defines that <code>bison</code> considers as <em><strong>discarded symbols</strong></em> :</p>
<p>Valid <em><strong>discarded symbols</strong></em> are the symbols that fall into <em>at least</em> one of the following categories:</p>
<ul>
<li>stacked symbols popped during the first phase of <strong>error recovery</strong></li>
<li>incoming terminals during the second phase of <strong>error recovery</strong></li>
<li>the current lookahead and the entire stack (except the current right-hand side symbols) in the case the parser is <em>fail-fast</em></li>
<li>the current lookahead and the entire stack (including the current right-hand side symbols) when the <code>C++</code> parser catches an exception in <code>parse</code></li>
<li>the start symbol when the parser succeeds</li>
</ul>
<p>Here’s how we can do that in our grammar :</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">%<span class="class"><span class="keyword">union</span>&#123;</span></span><br><span class="line">    SymbolInfo* symbol_info;</span><br><span class="line">    Helper* helper;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// specific destructor for &lt;helper&gt; </span></span><br><span class="line">%destructor &#123; <span class="built_in">eraseMemory_H</span>($$); &#125; &lt;helper&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">// specific destructor for &lt;symbol_info&gt; </span></span><br><span class="line">%destructor &#123; <span class="built_in">eraseMemory_S</span>($$); &#125; &lt;symbol_info&gt;</span><br><span class="line"></span><br><span class="line">%destructor &#123; <span class="comment">/* tagless symbol destructor */</span> &#125; &lt;&gt;</span><br></pre></td></tr></table></figure>

<p>Notice the <code>tag</code>-less destructor, which is called on <em><strong>every symbol that is present</strong>_. This might raise the question on how to select which destructor to call since there might be more than one. Should <code>bison</code> detects that there is a <code>tag</code>-specific destructor for a discarded symbol _<strong>it will call that and ignore the more generic one</strong></em>, so in case of discarding a symbol that has a semantic value of <code>&lt;symbol_info&gt;</code> then only the destructor for <code>&lt;symbol_info&gt;</code> will be called.</p>
<h1 id="Part-5-Intermediate-Code-Generator"><a href="#Part-5-Intermediate-Code-Generator" class="headerlink" title="Part 5 : Intermediate Code Generator"></a>Part 5 : <strong><code>Intermediate Code Generator</code></strong></h1><p>For the final piece of this puzzle, we need to write an intermediate code generator on top of our bison code , which will generate 8086 assembly code. We can simulate that using <strong>emu8086</strong> simulator</p>
<p>To do that we can add an extra attribute in out struct <code>Helper</code> and add the necessary code for the corresponding grammar. The code is then propagated as usual with the grammar.</p>
<p>Declaring variable can be done in 2 ways. We can put all the variables in the data segment or we can use stack for that. The latter is preferred. </p>
<p>We can also optimize our code in the following scenario</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov ax, a</span><br><span class="line">mov a, ax</span><br></pre></td></tr></table></figure>

<p>The second line is redundant and we can simply write</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov ax, a</span><br></pre></td></tr></table></figure>

<p>Some other optimizations can also be done. For example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x &#x3D; 5;</span><br><span class="line">x &#x3D; 10;</span><br></pre></td></tr></table></figure>
<p>we can ignore the code generated for the first line as that value is never used.</p>
<p>Another optimization can also be made for temporary variables. We can reallocate the temporary variables and ensure efficient use. </p>
<h1 id="Final-Words"><a href="#Final-Words" class="headerlink" title="Final Words"></a>Final Words</h1><p>If you are this far and done with the coding by yourself, just to let you know that you should be very proud of yourself. When I successfully run a recursion after the Intermediate Cdde Generation part, it was the most wholesome moment of my CS life :) Hope it was a wholesome journey for you too :)</p>
<p>&nbsp;</p>
<h3 id="Md-Zarif-Ul-Alam"><a href="#Md-Zarif-Ul-Alam" class="headerlink" title="Md. Zarif Ul Alam"></a><strong><code>Md. Zarif Ul Alam</code></strong></h3><p>CSE , BUET</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/mindcraft/">Home</a></li>
         
          <li><a href="/mindcraft/archives/">Archive</a></li>
         
          <li><a href="https://zarif98sjs.github.io/">About Me</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Part-1-Creating-a-Symbol-Table"><span class="toc-number">1.</span> <span class="toc-text">Part 1 : Creating a Symbol Table</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SymbolInfo"><span class="toc-number">1.1.</span> <span class="toc-text">SymbolInfo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ScopeTable"><span class="toc-number">1.2.</span> <span class="toc-text">ScopeTable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SymbolTable"><span class="toc-number">1.3.</span> <span class="toc-text">SymbolTable</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Part-2-Lexical-Analysis"><span class="toc-number">2.</span> <span class="toc-text">Part 2 : Lexical Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#flex-definition"><span class="toc-number">2.1.</span> <span class="toc-text">flex definition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flex-rule"><span class="toc-number">2.2.</span> <span class="toc-text">flex rule</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flex-states"><span class="toc-number">2.3.</span> <span class="toc-text">flex states</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flex-errors"><span class="toc-number">2.4.</span> <span class="toc-text">flex errors</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Part-3-Parser-Syntax-Analysis-amp-Semantic-Analysis"><span class="toc-number">3.</span> <span class="toc-text">Part 3 : Parser(Syntax Analysis) &amp; Semantic Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-Code"><span class="toc-number">3.1.</span> <span class="toc-text">User Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stack"><span class="toc-number">3.2.</span> <span class="toc-text">Stack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-YYSTYPE"><span class="toc-number">3.2.1.</span> <span class="toc-text">Using YYSTYPE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-union"><span class="toc-number">3.2.2.</span> <span class="toc-text">Using union</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Token"><span class="toc-number">3.3.</span> <span class="toc-text">Token</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-YYSTYPE-1"><span class="toc-number">3.3.1.</span> <span class="toc-text">Using YYSTYPE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-union-1"><span class="toc-number">3.3.2.</span> <span class="toc-text">Using union</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Type"><span class="toc-number">3.4.</span> <span class="toc-text">Type</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-YYSTYPE-2"><span class="toc-number">3.4.1.</span> <span class="toc-text">Using YYSTYPE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-union-2"><span class="toc-number">3.4.2.</span> <span class="toc-text">Using union</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Grammar"><span class="toc-number">3.5.</span> <span class="toc-text">Grammar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Accessing-token-and-types"><span class="toc-number">3.6.</span> <span class="toc-text">Accessing token and types</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Precedence"><span class="toc-number">3.7.</span> <span class="toc-text">Precedence</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shift-Reduce-Conflict"><span class="toc-number">3.8.</span> <span class="toc-text">Shift&#x2F;Reduce Conflict</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Freeing-Memory-Part-1"><span class="toc-number">3.9.</span> <span class="toc-text">Freeing Memory : Part 1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Caution"><span class="toc-number">3.9.1.</span> <span class="toc-text">Caution</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Part-4-Error-Recovery"><span class="toc-number">4.</span> <span class="toc-text">Part 4 : Error Recovery</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Freeing-Memory-Part-2"><span class="toc-number">4.1.</span> <span class="toc-text">Freeing Memory : Part 2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Part-5-Intermediate-Code-Generator"><span class="toc-number">5.</span> <span class="toc-text">Part 5 : Intermediate Code Generator</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Final-Words"><span class="toc-number">6.</span> <span class="toc-text">Final Words</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Md-Zarif-Ul-Alam"><span class="toc-number">6.0.1.</span> <span class="toc-text">Md. Zarif Ul Alam</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&text=Yet Another C Compiler"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&title=Yet Another C Compiler"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&is_video=false&description=Yet Another C Compiler"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Yet Another C Compiler&body=Check out this article: https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&title=Yet Another C Compiler"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&title=Yet Another C Compiler"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&title=Yet Another C Compiler"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&title=Yet Another C Compiler"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&name=Yet Another C Compiler&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://zarif98sjs.github.io/mindcraft/Yet-Another-C-Compiler/&t=Yet Another C Compiler"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <!-- <a target="_blank" rel="noopener" href="https://hits.seeyoufarm.com"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fzarif98sjs.github.io%2Fmindcraft%2F&count_bg=%2379C83D&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=hits&edge_flat=false"/></a> -->
  <div class="footer-left">
    Copyright &copy;
    
    
    2018-2021
    Md. Zarif Ul Alam
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/mindcraft/">Home</a></li>
         
          <li><a href="/mindcraft/archives/">Archive</a></li>
         
          <li><a href="https://zarif98sjs.github.io/">About Me</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/mindcraft/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
